C51 COMPILER V9.01   MAIN                                                                  06/30/2015 09:01:40 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          * ÊµÑéÃû                           :ÎÂ¶ÈÏÔÊ¾ÊµÑé
   3          * Ê¹ÓÃµÄIO           : 
   4          * ÊµÑéÐ§¹û       :              ÊýÂë¹ÜÏÔÊ¾ÎÂ¶È
   5          *       ×¢Òâ                                     £º
   6          *******************************************************************************/
   7          
   8          #include<reg51.h>
   9          #include"temp.h"
  10          
  11          //ÊýÂë¹ÜIO
  12          #define DIG     P0
  13          sbit LSA=P2^2;
  14          sbit LSB=P2^3;
  15          sbit LSC=P2^4;
  16          
  17          unsigned char code DIG_CODE[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  18          unsigned char Num=0;
  19          unsigned int disp[8]={0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f};
  20          
  21          void LcdDisplay(int);
  22          void Timer0Configuration();
  23          
  24          /*******************************************************************************
  25          * º¯ÊýÃû         : main
  26          * º¯Êý¹¦ÄÜ                 : Ö÷º¯Êý
  27          * ÊäÈë           : ÎÞ
  28          * Êä³ö           : ÎÞ
  29          *******************************************************************************/
  30          
  31          void main()
  32          {
  33   1          Timer0Configuration();
  34   1              while(1)
  35   1              {
  36   2                      LcdDisplay(Ds18b20ReadTemp());
  37   2              }
  38   1      }
  39          
  40          /*******************************************************************************
  41          * º¯ÊýÃû         : LcdDisplay()
  42          * º¯Êý¹¦ÄÜ               : ÊýÂë¹ÜÏÔÊ¾¶ÁÈ¡µ½µÄÎÂ¶È
  43          * ÊäÈë           : v
  44          * Êä³ö           : ÎÞ
  45          *******************************************************************************/
  46          
  47          void LcdDisplay(int temp)        //lcdÏÔÊ¾
  48          {
  49   1          
  50   1              unsigned char datas[] = {0, 0, 0, 0, 0}; //¶¨ÒåÊý×é
  51   1              float tp;  
  52   1              if(temp< 0)                             //µ±ÎÂ¶ÈÖµÎª¸ºÊý
  53   1              {
  54   2              disp[2] = 0x40;
  55   2                      //ÒòÎª¶ÁÈ¡µÄÎÂ¶ÈÊÇÊµ¼ÊÎÂ¶ÈµÄ²¹Âë£¬ËùÒÔ¼õ1£¬ÔÙÈ¡·´Çó³öÔ­Âë
C51 COMPILER V9.01   MAIN                                                                  06/30/2015 09:01:40 PAGE 2   

  56   2                      temp=temp-1;
  57   2                      temp=~temp;
  58   2                      tp=temp;
  59   2                      temp=tp*0.0625*100+0.5; 
  60   2                      //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
  61   2                      //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
  62   2                      //ËãÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
  63   2       
  64   2              }
  65   1              else
  66   1              {       
  67   2              disp[2] = 0;            
  68   2                      tp=temp;//ÒòÎªÊý¾Ý´¦ÀíÓÐÐ¡ÊýµãËùÒÔ½«ÎÂ¶È¸³¸øÒ»¸ö¸¡µãÐÍ±äÁ¿
  69   2                      //Èç¹ûÎÂ¶ÈÊÇÕýµÄÄÇÃ´£¬ÄÇÃ´ÕýÊýµÄÔ­Âë¾ÍÊÇ²¹ÂëËü±¾Éí
  70   2                      temp=tp*0.0625*100+0.5; 
  71   2                      //ÁôÁ½¸öÐ¡Êýµã¾Í*100£¬+0.5ÊÇËÄÉáÎåÈë£¬ÒòÎªCÓïÑÔ¸¡µãÊý×ª»»ÎªÕûÐÍµÄÊ±ºò°ÑÐ¡Êýµã
  72   2                      //ºóÃæµÄÊý×Ô¶¯È¥µô£¬²»¹ÜÊÇ·ñ´óÓÚ0.5£¬¶ø+0.5Ö®ºó´óÓÚ0.5µÄ¾ÍÊÇ½ø1ÁË£¬Ð¡ÓÚ0.5µÄ¾Í
  73   2                      //Ëã¼ÓÉÏ0.5£¬»¹ÊÇÔÚÐ¡ÊýµãºóÃæ¡£
  74   2              }
  75   1          disp[0] = 0;
  76   1          disp[1] = 0;
  77   1          disp[3] = DIG_CODE[temp / 10000];
  78   1              disp[4] = DIG_CODE[temp % 10000 / 1000];
  79   1              disp[5] = DIG_CODE[temp % 1000 / 100] | 0x80;
  80   1              disp[6] = DIG_CODE[temp % 100 / 10];
  81   1              disp[7] = DIG_CODE[temp % 10];
  82   1       
  83   1      }
  84          
  85          /*******************************************************************************
  86          * º¯ÊýÃû         : Timer0Configuration()
  87          * º¯Êý¹¦ÄÜ                 : ÉèÖÃ¼ÆÊ±Æ÷
  88          * ÊäÈë           : ÎÞ
  89          * Êä³ö           : ÎÞ
  90          *******************************************************************************/
  91          
  92          void Timer0Configuration()
  93          {
  94   1              TMOD=0X02;//Ñ¡ÔñÎª¶¨Ê±Æ÷Ä£Ê½£¬¹¤×÷·½Ê½2£¬½öÓÃTRX´ò¿ªÆô¶¯¡£
  95   1      
  96   1              TH0=0X9C;       //¸ø¶¨Ê±Æ÷¸³³õÖµ£¬¶¨Ê±100us
  97   1              TL0=0X9C;       
  98   1              ET0=1;//´ò¿ª¶¨Ê±Æ÷0ÖÐ¶ÏÔÊÐí
  99   1              EA=1;//´ò¿ª×ÜÖÐ¶Ï
 100   1              TR0=1;//´ò¿ª¶¨Ê±Æ÷              
 101   1      }
 102          
 103          /*******************************************************************************
 104          * º¯ÊýÃû         : DigDisplay() interrupt 1
 105          * º¯Êý¹¦ÄÜ                 : ÖÐ¶ÏÊýÂë¹ÜÏÔÊ¾
 106          * ÊäÈë           : ÎÞ
 107          * Êä³ö           : ÎÞ
 108          *******************************************************************************/
 109          
 110          void DigDisplay() interrupt 1
 111          {
 112   1      //¶¨Ê±Æ÷ÔÚ¹¤×÷·½Ê½¶þ»á×Ô¶¯ÖØ×°³õ£¬ËùÒÔ²»ÓÃÔÚ¸³Öµ¡£
 113   1      //      TH0=0X9c;//¸ø¶¨Ê±Æ÷¸³³õÖµ£¬¶¨Ê±1ms
 114   1      //      TL0=0X00;               
 115   1              DIG=0; //ÏûÒþ
 116   1              switch(Num)      //Î»Ñ¡£¬Ñ¡ÔñµãÁÁµÄÊýÂë¹Ü£¬
 117   1              {
C51 COMPILER V9.01   MAIN                                                                  06/30/2015 09:01:40 PAGE 3   

 118   2                      case(7):
 119   2                              LSA=0;LSB=0;LSC=0; break;
 120   2                      case(6):
 121   2                              LSA=1;LSB=0;LSC=0; break;
 122   2                      case(5):
 123   2                              LSA=0;LSB=1;LSC=0; break;
 124   2                      case(4):
 125   2                              LSA=1;LSB=1;LSC=0; break;
 126   2                      case(3):
 127   2                              LSA=0;LSB=0;LSC=1; break;
 128   2                      case(2):
 129   2                              LSA=1;LSB=0;LSC=1; break;
 130   2                      case(1):
 131   2                              LSA=0;LSB=1;LSC=1; break;
 132   2                      case(0):
 133   2                              LSA=1;LSB=1;LSC=1; break;       
 134   2              }
 135   1              DIG=disp[Num]; //¶ÎÑ¡£¬Ñ¡ÔñÏÔÊ¾µÄÊý×Ö¡£
 136   1              Num++;
 137   1              if(Num>7)
 138   1                      Num=0;
 139   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    461    ----
   CONSTANT SIZE    =     15    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
